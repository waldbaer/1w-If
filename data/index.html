<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>1-Wire Interface</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="js/menu.js"></script>
  <script src="js/config-util.js"></script>
</head>

<body>
  <div id="menu-container"></div>

  <h1>Available 1-Wire Devices</h1>
  <div id="ow-devices-table"></div>

  <h1>Control</h1>
  <button onclick="restartHardware()">Restart Hardware</button>
  <p id="restartHardwareStatus"></p>

  <script>
    LoadMenu('menu-container');

    // Visualize available 1-wire devices
    const ow_devices_json = '%OW_DEVICES%';
    //const ow_devices_json = '{"devices":[{"channel": 1, "device_id":"REVERT", "attributes":["---", "REVERT","---"]},{"channel": 2, "device_id":"01.D2C79A1A0000","attributes":["presence"]}]}';
    const ow_devices = JSON.parse(ow_devices_json);

    // Create table
    const ow_devices_table = document.getElementById("ow-devices-table");
    const table = document.createElement("table");

    // Create table header
    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");

    const th1 = document.createElement("th");
    th1.textContent = "Channel";
    const th2 = document.createElement("th");
    th2.textContent = "Device ID";
    const th3 = document.createElement("th");
    th3.textContent = "Attributes";

    headerRow.appendChild(th1);
    headerRow.appendChild(th2);
    headerRow.appendChild(th3);
    thead.appendChild(headerRow);
    table.appendChild(thead);

    // Create rows
    const tbody = document.createElement("tbody");
    ow_devices.devices.forEach(device => {
      const row = tbody.insertRow();
      row.insertCell().textContent = device.channel;
      row.insertCell().textContent = device.device_id;
      row.insertCell().textContent = device.attributes.join(", ");
    });
    table.appendChild(tbody)

    // Add table to container
    ow_devices_table.appendChild(table);
  </script>
</body>

</html>
